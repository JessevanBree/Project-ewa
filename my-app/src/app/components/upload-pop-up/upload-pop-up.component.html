<!-- Modal -->
<div class="modal fade" #uploadModal id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel"
     data-backdrop="false" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h5 class="modal-title" id="uploadModalLabel">Upload dataset</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="onSubmit(formElement)" #formElement="ngForm" (keydown.enter)="$event.preventDefault()"
              novalidate>

          <h5 class="border border-success text-center text-white bg-success">Dataset visualization</h5>
          <div class="form-group col-md-12 mx-3">
            <label for="uploadModalControlFile1">Choose dataset file <span
              class="font-italic small">(Accepted format: <abbr
              title="comma separated values">.csv</abbr>)</span></label>
            <input type="file" class="form-control-file pt-2"
                   (change)="uploadListener($event.target.files)"
                   id="uploadModalControlFile1" name="fileInput"
                   accept=".csv"
                   #csvReader
                   ngModel
                   required
                   [disabled]=confirmToggle>
          </div>
          <div id="chartConfiguration" class="form-row my-4" *ngIf="headers">
            <div class="card mx-4" id="headerCard">
              <div class="card-header">Chart configuration</div>
              <div class="card-body">
                <div class="form-group collapse show" id="chartOptions">
                  <label for="xAxisOptions">X axis</label>
                  <div class="form-group form-row mb-2">
                    <select (change)="onChanges()" [(ngModel)]="xAxisInputs[i]"
                            *ngFor="let input of xAxisInputs; let i = index"
                            class="form-control my-1 col-9" id="xAxisOptions" name="xAxis"
                            required>
                      <option *ngFor="let header of headers; let i = index" [ngValue]="i"
                              name="xOption">{{i}}. {{header}}</option>
                    </select>
                    <button type="button" [ngClass]="removeXAxesToggle ? 'btn-danger' : 'btn-primary'"
                            class="btn btn-sm ml-4" id="addXAxes" (click)="onAddXAxes()">
                      <i class="fa" [ngClass]="removeXAxesToggle ? 'fa-minus' : 'fa-plus'"></i>
                    </button>
                  </div>
                  <label for="yAxisOptions">Y axis</label>
                  <div class="form-group form-row">
                    <select (change)="onChanges()" [(ngModel)]="yAxisInput" class="form-control my-1 col-9"
                            name="yAxis" id="yAxisOptions" required>
                      <option *ngFor="let header of headers; let i = index" [ngValue]="i"
                              name="yOption">{{i}}. {{header}}</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="chartType">Chart type</label>
                    <select [(ngModel)]="chartType" id="chartType" name="chartTypeInput"
                            class="form-control col-md-4 my-1">
                      <option value="bar">Bar</option>
                      <option value="line">Line</option>
                      <option value="pie" [disabled]="xAxisInputs.length == 2">Pie</option>
                    </select>
                  </div>
                </div>
                <button type="button" class="btn float-right" data-toggle="collapse" data-target="#chartOptions"
                        aria-expanded="false" aria-controls="headerOptions" (click)="onConfirm()"
                        [innerHTML]="confirmToggle ? 'Change headers' : 'Confirm' "
                        [ngClass]="confirmToggle ? 'btn-outline-danger' : 'btn-primary'"
                        [disabled]="!validationToggle"></button>
              </div>
            </div>
          </div>
          <hr/>
          <h5 class="border border-success text-center text-white bg-success">Metadata</h5>
          <div class="form-row">
            <label for="titleInput">Title</label>
            <input
              required minlength="5"
              type="text"
              class="form-control"
              id="titleInput"
              name="titleInput"
              placeholder="Title"
              [(ngModel)]="nameInput"
              #title="ngModel"
              ngModel>
            <div *ngIf="title.hasError('minlength') && !title.hasError('required')" class="alert alert-danger">
              <p><span>Title should contain atleast 5 characters</span></p>
            </div>
          </div>
          <div class="form-group">
            <label for="descriptionInput">Description</label>
            <textarea
              class="form-control"
              id="descriptionInput"
              name="descriptionInput"
              [(ngModel)]="descriptionInput"
              placeholder='E.g. There are many households which produce their own electricity'
              ngModel></textarea>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="publicityInput">Publicity</label>
              <select
                id="publicityInput"
                class="form-control"
                name="publicityInput"
                [(ngModel)]="publicityInput"
                ngModel
                required>
                <option>Private</option>
                <!--                <option *ngIf="this.userService.getLoggedInUser().organisationsList">Group</option>   TODO:: IMPLMENT THIS OVER LINE BELOW-->
                <option *ngIf="this.userService.getLoggedInUser().organisationsList">Group</option>
                <option>Public</option>
              </select>
            </div>
            <!--            <div *ngIf="publicityInput == 'Group'" class="form-group col-md-6">-->
            <!--              <label for="groupInput">Publicity</label>-->
            <!--              <select-->
            <!--                id="groupInput"-->
            <!--                class="form-control"-->
            <!--                name="groupInput"-->
            <!--                ngModel-->
            <!--                required>-->
            <!--                <option-->
            <!--                  *ngFor="let organisation of organisationsOfUser; let index = index">-->
            <!--                  {{organisation.name}}</option>-->
            <!--                &lt;!&ndash; TODO:: make use of organisations lenght of logged in user &ndash;&gt;-->
            <!--              </select>-->
            <!--            </div>-->

            <!--            <div class="form-group col-md-6" *ngIf="publicityInput == 'Group'">-->
            <!--              <label>Organisation</label>-->
            <!--              <ng-multiselect-dropdown-->
            <!--                [placeholder]="'Select organisations'"-->
            <!--                [data]="organisationsOfUser"-->
            <!--                [(ngModel)]="selected"-->
            <!--                [settings]="dropdownSettings"-->
            <!--                (onSelect)="onItemSelect($event)"-->
            <!--                (onSelectAll)="onSelectAll($event)"-->
            <!--                name="organisationSelect"-->
            <!--              >-->
            <!--              </ng-multiselect-dropdown>-->
            <!--            </div>-->

            <div class="form-group col-md-6" *ngIf="publicityInput == 'Group'">
              <label>Groups</label>
              <ng-select [items]="organisationsOfUser"
                         required
                         #selectBox="ngModel"
                         bindLabel="name"
                         placeholder="Select organisation(s)"
                         appendTo="body"
                         name="organisationsSelect"
                         [multiple]="true"
                         [closeOnSelect]="false"
                         [(ngModel)]="selected"
                         (change)="onChangeOrganisationSelect()">
                <ng-template ng-header-tmp>

                  <div>
                    <button class="btn btn-link"
                            (click)="onSelectAll()">Select All
                    </button>
                    <button class="btn btn-link"
                            (click)="onClearAll()">Clear All
                    </button>
                  </div>

                </ng-template>
              </ng-select>
              <div *ngIf="selectBox.touched && selectBox.hasError('required')" class="alert alert-danger">
                <p>You must select one or more groups</p>
              </div>
            </div>

            <!--            <div class="dropdown show">-->
            <!--              <a class="btn btn-secondary dropdown-toggle" role="button" id="dropdownOrgs"-->
            <!--                 data-toggle="dropdown">-->
            <!--                Select Organisations-->
            <!--              </a>-->

            <!--              <div class="dropdown-menu" aria-labelledby="dropdownOrgs">-->
            <!--                <a class="dropdown-item"-->
            <!--                   *ngFor="let organisation of organisationsOfUser; let index = index">-->
            <!--                  <label class="checkbox"><input type="checkbox">{{organisation.name}}</label>-->
            <!--                </a>-->
            <!--              </div>-->
            <!--            </div>-->


            <div class="form-group col-md-12">
              <label for="yearOptions">Year</label>
              <select [(ngModel)]="yearInput" class="form-control" id="yearOptions" name="years">
                <option [ngValue]="year" *ngFor="let year of listOfYears"
                        name="yearOption">{{year}}</option>
              </select>
            </div>
          </div>


          <div class="form-row">
            <div class="form-group col-md-12" id="regionOptions">
              <label class="col-form-label">Regional level </label>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" [(ngModel)]="regionInput" value="Urban"
                       name="regionOptions"
                       id="urbanLevel">
                <label class="form-check-label" for="urbanLevel">Urban</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" [(ngModel)]="regionInput" value="European"
                       name="regionOptions"
                       id="europeanLevel">
                <label class="form-check-label" for="europeanLevel">European</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" [(ngModel)]="regionInput" value="National"
                       name="regionOptions"
                       id="nationalLevel">
                <label class="form-check-label" for="nationalLevel">National</label>
              </div>
            </div>

          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary" [disabled]="formElement.invalid || confirmToggle == false">
              Upload
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
